#!/bin/bash

# find environment
. hspf_config
if [ -z "$CBP_ROOT" ]; then
  echo "Can not find file hspf.config"
fi

echo "$@"
cmd=$1
shift
echo "$@"


found=0
#for p in bin run run/standard run/useful run/calibration/PWATER; do
#try replacing do loop with this find command
# returns only the first match
cd $CBP_ROOT/run
fpath=`find *|grep $cmd | head -n 1`
p=`dirname $fpath`
echo "path=$p"
echo "testing $CBP_ROOT/run/$p/$cmd"
  if test -f "$CBP_ROOT/run/$p/$cmd"; then
    echo "Found $cmd in $CBP_ROOT/run/$p/$cmd"
    # todo: have specific handlers to catch legacy scripts and use a different directory
    # instead of the default "bin"
    cd $CBP_ROOT/run/$p
    $CBP_ROOT/run/$p/$cmd "$@"
    found=1
  fi
#done

if [ $found -eq 0 ]; then
  echo "Error: Could not find '$cmd' in directory tree"
fi
